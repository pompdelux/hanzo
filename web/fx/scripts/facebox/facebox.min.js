(function(g){g.facebox=function(m,l){g.facebox.loading();g.facebox.content_klass=l;if(m.ajax){h(m.ajax)}else{if(m.image){f(m.image)}else{if(m.images){i(m.images,m.initial)}else{if(m.div){k(m.div)}else{if(g.isFunction(m)){m.call(g)}else{g.facebox.reveal(m)}}}}}};g.extend(g.facebox,{settings:{opacity:0,overlay:true,modal:false,imageTypes:["png","jpg","jpeg","gif"]},html:function(){return'<div id="facebox" style="display:none;">   <div class="popup">     <table>       <tbody>         <tr>           <td class="tl"/><td class="b"/><td class="tr"/>         </tr>         <tr>           <td class="b"/>           <td class="body">             <div class="content">             </div>             <div class="footer">               <a href="#" class="close"></a>            </div>           </td>           <td class="b"/>         </tr>         <tr>           <td class="bl"/><td class="b"/><td class="br"/>         </tr>       </tbody>     </table>   </div> </div>'},loading:function(){j();if(g(".loading",g("#facebox"))[0]){return true}e();g.facebox.wait();if(!g.facebox.settings.modal){g(document).bind("keydown.facebox",function(l){if(l.keyCode==27){g.facebox.close()}})}g(document).trigger("loading.facebox")},wait:function(){var l=g("#facebox");g(".content",l).empty();g(".body",l).children().hide().end().append('<div class="loading"></div>');g.facebox.centralize();l.show();g(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},centralize:function(){g("#facebox").css({top:g(window).scrollTop()+(g(window).height()/10),left:g(window).width()/2-(g("#facebox table").width()/2)})},reveal:function(m){g(document).trigger("beforeReveal.facebox");var l=g("#facebox");g(".content",l).attr("class",(g.facebox.content_klass||"")+" content").html(m);g(".loading",l).remove();g(".body",l).children().fadeIn("normal");l.css("left",g(window).width()/2-(g("#facebox table").width()/2));g(document).trigger("reveal.facebox").trigger("afterReveal.facebox")},close:function(){g(document).trigger("close.facebox");return false}});g.fn.facebox=function(l){if(l){g.extend(g.facebox.settings,l)}if(!g.facebox.settings.noAutoload){j()}return this.bind("click.facebox",function(){g.facebox.loading();var m=this.rel.match(/facebox\[?\.(\w+)\]?/);g.facebox.content_klass=m?m[1]:"";k(this.href);return false})};function j(){if(g.facebox.settings.inited){return}else{g.facebox.settings.inited=true}g(document).trigger("init.facebox");d();var l=g.facebox.settings.imageTypes.join("|");g.facebox.settings.imageTypesRegexp=new RegExp(".("+l+")$","i");g("body").append(g.facebox.html());if(!g.facebox.settings.noAutoload){a()}g("#facebox .close").click(g.facebox.close)}function a(){g("#facebox").find(".b:first, .loading, .close , .bl, .br, .tl, .tr").each(function(){return true;var l=new Image();l.src=g(this).css("background-image").replace(/url\((.+)\)/,"$1")})}function d(){var l=g.facebox.settings;l.imageTypes=l.image_types||l.imageTypes;l.faceboxHtml=l.facebox_html||l.faceboxHtml}function k(l){if(l.match(/#/)){var m=window.location.href.split("#")[0];var n=l.replace(m,"");g.facebox.reveal(g(n).show().replaceWith("<div id='facebox_moved'></div>"),g.facebox.content_klass)}else{if(l.match(g.facebox.settings.imageTypesRegexp)){f(l)}else{h(l)}}}function i(p,n){var m=g.inArray(n||0,p);if(m==-1){m=0}g("#facebox div.footer").append(g('<div class="navigation"><a class="prev"/><div class="counter"></div><a class="next"/></div>'));var l=g("#facebox .navigation");g(document).bind("afterClose.facebox",function(){l.remove()});function o(q){m=(m+q+p.length)%p.length;f(p[m]);l.find(".counter").html(m+1+" / "+p.length)}o(0);g(".prev",l).click(function(){o(-1)});g(".next",l).click(function(){o(1)});g(document).bind("keydown.facebox",function(q){if(q.keyCode==39){o(1)}if(q.keyCode==37){o(-1)}})}function f(l){g("#facebox .content").empty();g.facebox.loading();var m=new Image();m.onload=function(){g.facebox.reveal('<div class="image"><img src="'+m.src+'" /></div>',g.facebox.content_klass)};m.src=l}function h(l){g.get(l,function(m){g.facebox.reveal(m)})}function c(){return g.facebox.settings.overlay==false||g.facebox.settings.opacity===null}function e(){if(c()){return}if(g("#facebox_overlay").length==0){g("body").append('<div id="facebox_overlay" class="facebox_hide"></div>')}g("#facebox_overlay").hide().addClass("facebox_overlayBG").css("opacity",g.facebox.settings.opacity).fadeIn(200);if(!g.facebox.settings.modal){g("#facebox_overlay").click(function(){g(document).trigger("close.facebox")})}return false}function b(){if(c()){return}g("#facebox_overlay").fadeOut(200,function(){g("#facebox_overlay").removeClass("facebox_overlayBG").addClass("facebox_hide").remove()});return false}g(document).bind("close.facebox",function(){g(document).unbind("keydown.facebox");g("#facebox").fadeOut(function(){g("#facebox_moved").replaceWith(g("#facebox .content").children().hide());b();g("#facebox .loading").remove()});g(document).trigger("afterClose.facebox")})})(jQuery);
